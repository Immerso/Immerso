!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){e.exports=Omnitone},function(e,t,n){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available. Did you include A-Frame?");n(2)},function(e,t,n){"use strict";n.r(t);var i,o,a=n(0),s=n.n(a);window.AFRAME;i=o=function(){};var d=window.AFRAME,r=window.THREE;function u(e,t,n){e&&(n?e.setAttribute(t,!0):e.removeAttribute(t))}function l(e){var t=e+1;return t*t}var c=["setCamera","onEntityChange","onLoadSound","onPlaySound","onPauseSound","onEndSound"],h={sid:[0,3,1,2,8,4,7,5,6,15,9,14,10,13,11,12],fuma:[0,3,1,2,6,7,5,8,4,12,13,11,14,10,15,9]},m=/^([0-9]+)(\s*,\s*([0-9]+))*$/;d.registerComponent("ambisonic",{schema:{src:{type:"audio"},sources:{type:"array",default:[]},loop:{type:"boolean",default:!0},autoplay:{type:"boolean",default:!1},useMediaElement:{type:"boolean",default:!0},order:{type:"number",default:1},channelMap:{parse:function(e){return"string"==typeof e&&(e=e.trim().toLowerCase()),h[e]?h[e]:m.test(e)?e.split(",").map(parseFloat):[]},stringify:function(e){return Array.isArray(e)?e.join(", "):e},default:"ACN"},mode:{default:"ambisonic",oneOf:["bypass","ambisonic","off"]}},init:function(){var e=this;this.context=null,this.renderer=null,this.audio=null,this.mediaElement=null,this.audioSources=[],this.loading=!1,this.ownMediaElement=!1,this.playing=!1,c.forEach((function(t){e[t]=e[t].bind(e)})),this.el.addEventListener("componentchanged",this.onEntityChange)},update:function(e){var t=this,n=this.el.sceneEl,a=n.audioListener,d=a&&a.context||this.context||r.AudioContext.getContext();this.camera=n.camera||null,n.addEventListener("camera-set-active",this.setCamera);var u=this.data,c=u.order,h=u.src,m=u.sources,f=l(c),p=this.data.useMediaElement&&(!m||!(m.length>=2)),E=d!==this.context||!this.renderer||this.renderer.input.channelCount>4!=f>=4;if(E){this.context=d,this.resumeAudioContext(),this.renderer&&(this.renderer.output.disconnect(),this.renderer=null);var y=4===f?s.a.createFOARenderer:s.a.createHOARenderer,v=this.renderer=y(this.context,{ambisonicOrder:c});v.initialize().then((function(){v===t.renderer&&d===t.context&&(t.audio.gain.connect(t.renderer.input),v.output.connect(d.destination),t.updateAmbisonicSettings())})),this.audio=new r.Audio(a||{context:d,getInput:function(){return d.destination}}),this.audio.gain.disconnect()}if(E||!!e.useMediaElement!=!!p||e.src!==h||JSON.stringify(e.sources)!==JSON.stringify(m))if(p){var g=null;h instanceof window.HTMLMediaElement?(g=h,this.ownMediaElement=!1):h&&((g=document.createElement("audio")).src=h,this.ownMediaElement=!0),this.mediaElement!==g&&this.cleanMediaAssets(),g&&(g.addEventListener("play",this.onPlaySound),g.addEventListener("pause",this.onPauseSound),g.addEventListener("load",this.onLoadSound),g.addEventListener("canplay",this.onLoadSound),g.addEventListener("ended",this.onEndSound)),!this.mediaElement&&g&&this.ownMediaElement&&(g.onerror=function(e){o("Error loading audio",h,e)},g.onloadedmetadata=function(){i("Audio metadata loaded",h,t.mediaElement)}),this.mediaElement=g,this.audioSources=[],this.mediaElement?this.audio.setMediaElementSource(this.mediaElement):this.audio.source&&this.audio.disconnect()}else{var S=h;if(h&&"string"!=typeof h&&h instanceof window.HTMLMediaElement){if("video"===h.tagName.toLowerCase())throw new Error("Unable to load video as audio buffer");S=h.src||h.srcObject||h.currentSrc}m&&m.length?this.audioSources=m:this.audioSources=[S],this.cleanMediaAssets(),this.data.autoplay&&this.loadBuffer()}this.updatePlaybackSettings(),this.updateAmbisonicSettings()},tick:function(){var e,t;this.renderer&&this.camera&&(e=this.renderer,t=this.camera,e.setRotationMatrix4(t.matrixWorldInverse.elements))},play:function(){this.data.autoplay&&this.playSound()},pause:function(){this.pauseSound()},cleanMediaAssets:function(){this.mediaElement&&(this.mediaElement.removeEventListener("play",this.playSound),this.mediaElement.removeEventListener("pause",this.onPauseSound),this.mediaElement.removeEventListener("load",this.onLoadSound),this.mediaElement.removeEventListener("canplay",this.onLoadSound),this.mediaElement.removeEventListener("ended",this.onEndSound),this.ownMediaElement&&(this.mediaElement.pause(),this.mediaElement.src="",this.mediaElement.load()),this.mediaElement=null),this.audio&&(this.audio.isPlaying&&this.audio.stop(),this.audio.source&&this.audio.source.removeEventListener("ended",this.onEndSound),this.audio.source=null,this.audio.buffer=null,this.audio.sourceType="empty"),this.loading&&(this.loading=!1)},remove:function(){var e=this.el,t=e&&e.sceneEl;t&&t.removeEventListener("camera-set-active",this.setCamera),this.el.removeEventListener("componentchanged",this.onEntityChange),this.disconnect(),this.cleanMediaAssets()},setCamera:function(e){this.camera=e.detail.cameraEl.getObject3D("camera")},resumeAudioContext:function(){return this.context&&this.context.resume&&"suspended"===this.context.state?this.context.resume().catch((function(){})):Promise.resolve()},loadBuffer:function(){var e=this;this.resumeAudioContext().then((function(){if(!e.loading&&e.audioSources.length){e.loading=!0;var t=JSON.stringify(e.audioSources);s.a.createBufferList(e.context,e.audioSources).then((function(n){var i=s.a.mergeBufferListByChannel(e.context,n);e.data.useMediaElement&&(!t||!(t.length>=2))||t!==JSON.stringify(e.audioSources)||(e.audio.setBuffer(i),e.onLoadSound(),e.updatePlaybackSettings(),e.playing&&e.playSound())})).catch((function(t){o("Unable to decode audio source",e.audioSources,t)}))}}))},playSound:function(){if(this.playing=!0,this.resumeAudioContext(),this.mediaElement){var e=this.mediaElement.play();e&&e.catch((function(e){o("Unable to play media",e.message)}))}else this.audio&&!this.audio.isPlaying&&(this.loadBuffer(),this.audio.buffer&&(this.audio.play(),this.audio.source.addEventListener("ended",this.onEndSound),this.onPlaySound()))},pauseSound:function(){this.playing=!1,this.mediaElement?this.mediaElement.pause():this.audio&&this.audio.isPlaying&&(this.audio.pause(),this.onPauseSound())},stopSound:function(){this.mediaElement?this.mediaElement.pause():this.audio&&(this.audio.stop(),this.onPauseSound())},onPlaySound:function(){this.resumeAudioContext(),this.el.emit("sound-play")},onPauseSound:function(){this.el.emit("sound-pause")},onLoadSound:function(){this.el.emit("sound-loaded")},onEndSound:function(){this.audio&&this.audio.source&&(this.onPauseSound(),this.audio.source.removeEventListener("ended",this.onEndSound)),this.el.emit("sound-ended")},updateAmbisonicSettings:function(){if(this.renderer){if(this.renderer.setChannelMap){for(var e=this.data.channelMap.slice(0),t=l(this.data.order),n=e.length;n<t;n++)e[n]=n;e.length=t,this.renderer.setChannelMap((e.length,e))}var i=this.data,o=i.order,a=i.mode,s=o>=1&&o<=3||"ambisonic"!==a?this.data.mode:"bypass";this.renderer.setRenderingMode(s)}},updatePlaybackSettings:function(){this.mediaElement?this.ownMediaElement&&(u(this.mediaElement,"loop",this.data.loop),u(this.mediaElement,"autoplay",this.data.autoplay)):this.audio&&(this.audio.setLoop(this.data.loop),this.audio.autoplay=this.data.autoplay)},onEntityChange:function(e){"rotation"===e.detail.name&&this.el.sceneEl.object3D.updateMatrixWorld(!0)},disconnect:function(){this.audio&&(this.audio.disconnect(),this.audio.gain.disconnect()),this.renderer&&(this.renderer.input.disconnect(),this.renderer.output.disconnect())}}),d.registerPrimitive("a-ambisonic",{defaultComponents:{ambisonic:{}},mappings:{src:"ambisonic.src",sources:"ambisonic.sources",loop:"ambisonic.loop",autoplay:"ambisonic.autoplay",order:"ambisonic.order","use-media-element":"ambisonic.useMediaElement","channel-map":"ambisonic.channelMap",mode:"ambisonic.mode"}})}]);
//# sourceMappingURL=aframe-ambisonic-component-no-omnitone.min.js.map