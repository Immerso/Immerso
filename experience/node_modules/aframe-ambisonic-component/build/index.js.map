{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"omnitone/build/omnitone.esm\"","webpack:///./src/index.js","webpack:///./src/log.js","webpack:///./src/ambisonic-audio.js"],"names":["AFRAME","Error","module","require","log","warn","window","THREE","setBooleanAttribute","element","attr","value","setAttribute","removeAttribute","MIN_ORDER","MAX_ORDER","isSafari","isIOS","safariChannelMap","w","x","y","z","setRotationMatrixFromCamera","renderer","camera","setRotationMatrix4","matrixWorldInverse","elements","channelCount","order","orderPlus1","boundMethods","channelMapSchemes","sid","fuma","intArrayRegex","registerComponent","schema","src","type","sources","default","loop","autoplay","useMediaElement","channelMap","parse","str","trim","toLowerCase","test","split","map","parseFloat","stringify","Array","isArray","join","mode","oneOf","init","context","audio","mediaElement","audioSources","loading","ownMediaElement","playing","forEach","name","bind","el","addEventListener","onEntityChange","update","oldData","sceneEl","listener","audioListener","AudioContext","getContext","setCamera","data","channels","length","rebuildOmnitone","input","resumeAudioContext","output","disconnect","createRenderer","Omnitone","createFOARenderer","createHOARenderer","ambisonicOrder","initialize","then","gain","connect","destination","updateAmbisonicSettings","Audio","getInput","rebuildSound","JSON","newMediaElement","HTMLMediaElement","document","createElement","cleanMediaAssets","onPlaySound","onPauseSound","onLoadSound","onEndSound","onerror","evt","onloadedmetadata","setMediaElementSource","source","url","tagName","srcObject","currentSrc","loadBuffer","updatePlaybackSettings","tick","play","playSound","pause","pauseSound","removeEventListener","load","isPlaying","stop","buffer","sourceType","remove","detail","cameraEl","getObject3D","resume","state","catch","Promise","resolve","createBufferList","results","audioBuffer","mergeBufferListByChannel","setBuffer","error","playPromise","e","message","stopSound","emit","setChannelMap","slice","i","validOrder","renderingMode","setRenderingMode","setLoop","object3D","updateMatrixWorld","registerPrimitive","defaultComponents","mappings"],"mappings":"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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","module.exports = require(\"omnitone/build/omnitone.esm\");","/* global AFRAME */\nif (typeof AFRAME === 'undefined') {\n\tthrow new Error('Component attempted to register before AFRAME was available. Did you include A-Frame?');\n}\n\nif (module.hot) {\n\tmodule.hot.accept();\n}\n\nrequire('./ambisonic-audio');\n","/* global DEBUG */\n\nlet log;\nlet warn;\n\nconst AFRAME = window.AFRAME;\nif (typeof DEBUG !== 'undefined' && DEBUG && AFRAME) {\n\tlog = AFRAME.utils.debug('components:ambisonic:info');\n\twarn = AFRAME.utils.debug('components:ambisonic:warn');\n} else {\n\tlog = warn = () => {};\n}\n\nexport { log, warn };","import Omnitone from 'omnitone/build/omnitone.esm';\n// import * as AFRAME from 'aframe';\n// import * as THREE from 'three';\nconst AFRAME = window.AFRAME;\nconst THREE = window.THREE; // imported by aframe\nimport { log, warn } from './log';\n\nfunction setBooleanAttribute(element, attr, value) {\n\tif (element) {\n\t\tif (value) {\n\t\t\telement.setAttribute(attr, true);\n\t\t} else {\n\t\t\telement.removeAttribute(attr);\n\t\t}\n\t}\n}\n\nconst MIN_ORDER = 1;\nconst MAX_ORDER = 3;\nconst isSafari = false;// /safari/i.test(Omnitone.browserInfo.name);\nconst isIOS = false;// /iP(ad|od|hone)/.test(Omnitone.browserInfo.platform);\nconst safariChannelMap = ([w, x, y, z]) => [y, w, x, z];\n\nfunction setRotationMatrixFromCamera(renderer, camera) {\n\trenderer.setRotationMatrix4(camera.matrixWorldInverse.elements);\n}\n\nfunction channelCount(order) {\n\tconst orderPlus1 = order + 1;\n\treturn orderPlus1 * orderPlus1;\n}\n\nconst boundMethods = [\n\t'setCamera',\n\t'onEntityChange',\n\t'onLoadSound',\n\t'onPlaySound',\n\t'onPauseSound',\n\t'onEndSound'\n];\n\nconst channelMapSchemes = {\n\t// acn: n => n,\n\tsid: [\n\t\t0,  3,  1,  2,\n\t\t8,  4,  7,  5,\n\t\t6, 15,  9, 14,\n\t\t10, 13, 11, 12\n\t],\n\tfuma: [\n\t\t0,  3,  1,  2,\n\t\t6,  7,  5,  8,\n\t\t4, 12, 13, 11,\n\t\t14, 10, 15,  9\n\t]\n};\nconst intArrayRegex = /^([0-9]+)(\\s*,\\s*([0-9]+))*$/;\n\nAFRAME.registerComponent('ambisonic', {\n\tschema: {\n\t\tsrc: { type: 'audio' },\n\t\tsources: { type: 'array', default: [] },\n\t\tloop: { type: 'boolean', default: true },\n\t\tautoplay: { type: 'boolean', default: false },\n\t\tuseMediaElement: { type: 'boolean', default: true },\n\t\torder: { type: 'number', default: 1 },\n\t\tchannelMap: {\n\t\t\tparse: str => {\n\t\t\t\tif (typeof str === 'string') {\n\t\t\t\t\tstr = str.trim().toLowerCase();\n\t\t\t\t}\n\t\t\t\tif (channelMapSchemes[str]) {\n\t\t\t\t\treturn channelMapSchemes[str];\n\t\t\t\t}\n\n\t\t\t\tif (intArrayRegex.test(str)) {\n\t\t\t\t\treturn str.split(',').map(parseFloat);\n\t\t\t\t}\n\n\t\t\t\treturn [];\n\t\t\t},\n\t\t\tstringify: value => {\n\t\t\t\tif (Array.isArray(value)) {\n\t\t\t\t\treturn value.join(', ');\n\t\t\t\t}\n\t\t\t\treturn value;\n\t\t\t},\n\t\t\tdefault: 'ACN'\n\t\t},\n\t\tmode: {\n\t\t\tdefault: 'ambisonic',\n\t\t\toneOf: [\n\t\t\t\t'bypass',\n\t\t\t\t'ambisonic',\n\t\t\t\t'off'\n\t\t\t]\n\t\t}\n\t},\n\n\tinit() {\n\t\tthis.context = null;\n\t\tthis.renderer = null;\n\t\tthis.audio = null;\n\t\tthis.mediaElement = null;\n\t\tthis.audioSources = [];\n\t\tthis.loading = false;\n\n\t\tthis.ownMediaElement = false;\n\t\tthis.playing = false;\n\n\t\t// bind any event handling methods\n\t\tboundMethods.forEach(name => {\n\t\t\tthis[name] = this[name].bind(this);\n\t\t});\n\n\t\t// Update on entity change.\n\t\tthis.el.addEventListener('componentchanged', this.onEntityChange);\n\t},\n\n\tupdate(oldData) {\n\t\tconst el = this.el;\n\t\tconst sceneEl = el.sceneEl;\n\t\t// todo: handle changed scene element\n\n\t\t// try to get context from scene audio listener. otherwise, make our own\n\t\tconst listener = sceneEl.audioListener;\n\t\tconst context = listener && listener.context || this.context || THREE.AudioContext.getContext();\n\n\t\t// Wait for camera if necessary.\n\t\tthis.camera = sceneEl.camera || null;\n\t\tsceneEl.addEventListener('camera-set-active', this.setCamera);\n\n\t\t// if context changed, then need to rebuild omnitone instance\n\t\t// todo: rebuild if type of Omnitone renderer (order) changed\n\t\tconst {\n\t\t\torder,\n\t\t\tsrc,\n\t\t\tsources\n\t\t} = this.data;\n\n\t\tconst channels = channelCount(order);\n\t\tconst useMediaElement = this.data.useMediaElement &&\n\t\t\t(!sources || !(sources.length >= 2));\n\n\t\tconst rebuildOmnitone = context !== this.context ||\n\t\t\t!this.renderer ||\n\t\t\tthis.renderer.input.channelCount > 4 !== channels >= 4;\n\n\t\tif (rebuildOmnitone) {\n\t\t\tthis.context = context;\n\t\t\tthis.resumeAudioContext();\n\n\t\t\tif (this.renderer) {\n\t\t\t\t// clean up old renderer\n\t\t\t\tthis.renderer.output.disconnect();\n\t\t\t\tthis.renderer = null;\n\t\t\t}\n\n\t\t\tconst createRenderer = channels === 4 ?\n\t\t\t\tOmnitone.createFOARenderer :\n\t\t\t\tOmnitone.createHOARenderer;\n\n\t\t\tconst renderer = this.renderer = createRenderer(this.context, { ambisonicOrder: order });\n\n\t\t\trenderer.initialize().then(() => {\n\t\t\t\tif (renderer !== this.renderer || context !== this.context) {\n\t\t\t\t\t// things changed while we were initializing so abort\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.audio.gain.connect(this.renderer.input);\n\t\t\t\trenderer.output.connect(context.destination);\n\n\t\t\t\tthis.updateAmbisonicSettings();\n\t\t\t});\n\n\t\t\tthis.audio = new THREE.Audio(listener || {\n\t\t\t\tcontext,\n\t\t\t\tgetInput: () => context.destination\n\t\t\t});\n\t\t\tthis.audio.gain.disconnect();\n\t\t}\n\n\t\tconst rebuildSound = rebuildOmnitone ||\n\t\t\t!!oldData.useMediaElement !== !!useMediaElement ||\n\t\t\toldData.src !== src ||\n\t\t\tJSON.stringify(oldData.sources) !== JSON.stringify(sources);\n\n\t\tif (rebuildSound) {\n\t\t\tif (useMediaElement) {\n\t\t\t\tlet newMediaElement = null;\n\t\t\t\tif (src instanceof window.HTMLMediaElement) {\n\t\t\t\t\tnewMediaElement = src;\n\t\t\t\t\tthis.ownMediaElement = false;\n\t\t\t\t} else if (src) {\n\t\t\t\t\tnewMediaElement = document.createElement('audio');\n\t\t\t\t\tnewMediaElement.src = src;\n\t\t\t\t\t// this.mediaElement.load();\n\t\t\t\t\tthis.ownMediaElement = true;\n\t\t\t\t}\n\t\t\t\tif (this.mediaElement !== newMediaElement) {\n\t\t\t\t\tthis.cleanMediaAssets();\n\t\t\t\t}\n\t\t\t\tif (newMediaElement) {\n\t\t\t\t\tnewMediaElement.addEventListener('play', this.onPlaySound);\n\t\t\t\t\tnewMediaElement.addEventListener('pause', this.onPauseSound);\n\t\t\t\t\tnewMediaElement.addEventListener('load', this.onLoadSound);\n\t\t\t\t\tnewMediaElement.addEventListener('canplay', this.onLoadSound);\n\t\t\t\t\tnewMediaElement.addEventListener('ended', this.onEndSound);\n\t\t\t\t}\n\n\t\t\t\tif (!this.mediaElement && newMediaElement && this.ownMediaElement) {\n\t\t\t\t\tnewMediaElement.onerror = evt => {\n\t\t\t\t\t\twarn('Error loading audio', src, evt);\n\t\t\t\t\t};\n\t\t\t\t\tnewMediaElement.onloadedmetadata = () => {\n\t\t\t\t\t\tlog('Audio metadata loaded', src, this.mediaElement);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tthis.mediaElement = newMediaElement;\n\t\t\t\tthis.audioSources = [];\n\t\t\t\tif (this.mediaElement) {\n\t\t\t\t\tthis.audio.setMediaElementSource(this.mediaElement);\n\t\t\t\t} else if (this.audio.source) {\n\t\t\t\t\tthis.audio.disconnect();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// load audio buffer\n\n\t\t\t\tlet url = src;\n\t\t\t\tif (src && typeof src !== 'string' && src instanceof window.HTMLMediaElement) {\n\t\t\t\t\tif (src.tagName.toLowerCase() === 'video') {\n\t\t\t\t\t\tthrow new Error('Unable to load video as audio buffer');\n\t\t\t\t\t}\n\t\t\t\t\turl = src.src || src.srcObject || src.currentSrc;\n\t\t\t\t}\n\n\t\t\t\tif (sources && sources.length) {\n\t\t\t\t\tthis.audioSources = sources;\n\t\t\t\t} else {\n\t\t\t\t\tthis.audioSources = [url];\n\t\t\t\t}\n\t\t\t\tthis.cleanMediaAssets();\n\t\t\t\tif (this.data.autoplay) {\n\t\t\t\t\tthis.loadBuffer();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.updatePlaybackSettings();\n\t\tthis.updateAmbisonicSettings();\n\t},\n\n\ttick() {\n\t\tif (this.renderer && this.camera) {\n\t\t\tsetRotationMatrixFromCamera(this.renderer, this.camera);\n\t\t}\n\t},\n\n\tplay() {\n\t\tif (this.data.autoplay) {\n\t\t\tthis.playSound();\n\t\t}\n\t},\n\n\tpause() {\n\t\tthis.pauseSound();\n\t},\n\n\tcleanMediaAssets() {\n\t\t// clean up all sound assets\n\t\tif (this.mediaElement) {\n\t\t\tthis.mediaElement.removeEventListener('play', this.playSound);\n\t\t\tthis.mediaElement.removeEventListener('pause', this.onPauseSound);\n\t\t\tthis.mediaElement.removeEventListener('load', this.onLoadSound);\n\t\t\tthis.mediaElement.removeEventListener('canplay', this.onLoadSound);\n\t\t\tthis.mediaElement.removeEventListener('ended', this.onEndSound);\n\t\t\tif (this.ownMediaElement) {\n\t\t\t\tthis.mediaElement.pause();\n\t\t\t\tthis.mediaElement.src = '';\n\t\t\t\tthis.mediaElement.load();\n\t\t\t}\n\t\t\tthis.mediaElement = null;\n\t\t}\n\t\tif (this.audio) {\n\t\t\tif (this.audio.isPlaying) {\n\t\t\t\tthis.audio.stop();\n\t\t\t}\n\t\t\tif (this.audio.source) {\n\t\t\t\tthis.audio.source.removeEventListener('ended', this.onEndSound);\n\t\t\t}\n\t\t\tthis.audio.source = null;\n\t\t\tthis.audio.buffer = null;\n\t\t\tthis.audio.sourceType = 'empty';\n\t\t}\n\t\tif (this.loading) {\n\t\t\t// todo: find a way to abort loader\n\t\t\tthis.loading = false;\n\t\t}\n\t},\n\n\tremove() {\n\t\tconst el = this.el;\n\t\tconst sceneEl = el && el.sceneEl;\n\t\tif (sceneEl) {\n\t\t\tsceneEl.removeEventListener('camera-set-active', this.setCamera);\n\t\t}\n\t\tthis.el.removeEventListener('componentchanged', this.onEntityChange);\n\t\tthis.disconnect();\n\t\tthis.cleanMediaAssets();\n\t},\n\n\tsetCamera(evt) {\n\t\tthis.camera = evt.detail.cameraEl.getObject3D('camera');\n\t},\n\n\t// resume audio context\n\tresumeAudioContext() {\n\t\tif (this.context && this.context.resume && this.context.state === 'suspended') {\n\t\t\treturn this.context.resume().catch(() => {});\n\t\t}\n\n\t\treturn Promise.resolve();\n\t},\n\n\tloadBuffer() {\n\t\tthis.resumeAudioContext().then(() => {\n\t\t\tif (this.loading || !this.audioSources.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.loading = true;\n\t\t\tconst sources = JSON.stringify(this.audioSources);\n\t\t\tOmnitone.createBufferList(this.context, this.audioSources)\n\t\t\t\t.then(results => {\n\t\t\t\t\tconst audioBuffer = Omnitone.mergeBufferListByChannel(this.context, results);\n\t\t\t\t\tconst useMediaElement = this.data.useMediaElement && (!sources || !(sources.length >= 2));\n\t\t\t\t\tif (!useMediaElement && sources === JSON.stringify(this.audioSources)) {\n\t\t\t\t\t\tthis.audio.setBuffer(audioBuffer);\n\t\t\t\t\t\tthis.onLoadSound();\n\t\t\t\t\t\tthis.updatePlaybackSettings();\n\t\t\t\t\t\tif (this.playing) {\n\t\t\t\t\t\t\tthis.playSound();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch(error => {\n\t\t\t\t\twarn('Unable to decode audio source', this.audioSources, error);\n\t\t\t\t});\n\t\t});\n\t},\n\n\t// set play state to start when loaded\n\tplaySound() {\n\t\tthis.playing = true;\n\t\tthis.resumeAudioContext();\n\t\tif (this.mediaElement) {\n\t\t\tconst playPromise = this.mediaElement.play();\n\t\t\tif (playPromise) {\n\t\t\t\tplayPromise.catch(e => {\n\t\t\t\t\twarn('Unable to play media', e.message);\n\t\t\t\t});\n\t\t\t}\n\t\t} else if (this.audio && !this.audio.isPlaying) {\n\t\t\tthis.loadBuffer();\n\t\t\tif (this.audio.buffer) {\n\t\t\t\tthis.audio.play();\n\t\t\t\tthis.audio.source.addEventListener('ended', this.onEndSound);\n\t\t\t\tthis.onPlaySound();\n\t\t\t}\n\t\t}\n\t},\n\n\tpauseSound() {\n\t\tthis.playing = false;\n\t\tif (this.mediaElement) {\n\t\t\tthis.mediaElement.pause();\n\t\t} else if (this.audio && this.audio.isPlaying) {\n\t\t\tthis.audio.pause();\n\t\t\tthis.onPauseSound();\n\t\t}\n\t},\n\n\tstopSound() {\n\t\tif (this.mediaElement) {\n\t\t\tthis.mediaElement.pause();\n\t\t} else if (this.audio) {\n\t\t\tthis.audio.stop();\n\t\t\tthis.onPauseSound();\n\t\t}\n\t},\n\n\tonPlaySound() {\n\t\tthis.resumeAudioContext();\n\t\tthis.el.emit('sound-play');\n\t},\n\n\tonPauseSound() {\n\t\tthis.el.emit('sound-pause');\n\t},\n\n\tonLoadSound() {\n\t\tthis.el.emit('sound-loaded');\n\t},\n\n\tonEndSound() {\n\t\tif (this.audio && this.audio.source) {\n\t\t\tthis.onPauseSound();\n\t\t\tthis.audio.source.removeEventListener('ended', this.onEndSound);\n\t\t}\n\t\tthis.el.emit('sound-ended');\n\t},\n\n\t/**\n\t* Update the Omnitone sound settings.\n\t*/\n\tupdateAmbisonicSettings() {\n\t\tif (this.renderer) {\n\t\t\tif (this.renderer.setChannelMap) {\n\t\t\t\tconst channelMap = this.data.channelMap.slice(0);\n\n\t\t\t\t// fill in any missing channel map values in case they're left out\n\t\t\t\tconst channels = channelCount(this.data.order);\n\t\t\t\tfor (let i = channelMap.length; i < channels; i++) {\n\t\t\t\t\tchannelMap[i] = i;\n\t\t\t\t}\n\t\t\t\tchannelMap.length = channels;\n\n\t\t\t\t/*\n\t\t\t\tPer various documents on the internet, Safari messes up the\n\t\t\t\torder of the channels, but that does not seem to be the case.\n\t\t\t\tMaybe it's been fixed in a recent version, so this is disabled\n\t\t\t\tfor now.\n\t\t\t\t*/\n\t\t\t\tthis.renderer.setChannelMap(\n\t\t\t\t\tchannelMap.length === 4 && isSafari ?\n\t\t\t\t\t\tsafariChannelMap(channelMap) :\n\t\t\t\t\t\tchannelMap\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Mobile Safari cannot decode all the audio channels from a media element\n\t\t\tconst { order, mode } = this.data;\n\t\t\tconst validOrder = order >= MIN_ORDER && order <= MAX_ORDER;\n\t\t\tconst renderingMode = (isIOS || !validOrder) && mode === 'ambisonic' ?\n\t\t\t\t'bypass' :\n\t\t\t\tthis.data.mode;\n\t\t\tthis.renderer.setRenderingMode(renderingMode);\n\t\t}\n\t},\n\n\t/**\n\t* Update the playback settings.\n\t*/\n\tupdatePlaybackSettings() {\n\t\tif (this.mediaElement) {\n\n\t\t\t// only if we created this element\n\t\t\tif (this.ownMediaElement) {\n\t\t\t\tsetBooleanAttribute(this.mediaElement, 'loop', this.data.loop);\n\t\t\t\tsetBooleanAttribute(this.mediaElement, 'autoplay', this.data.autoplay);\n\t\t\t}\n\t\t} else if (this.audio) {\n\t\t\tthis.audio.setLoop(this.data.loop);\n\t\t\tthis.audio.autoplay = this.data.autoplay;\n\t\t}\n\t\t// todo: other props like playbackRate, detune, etc.\n\t},\n\n\n\t/**\n\t* When the entity's rotation is changed, update the Omnitone rotation accordingly.\n\t* @param {Event} evt\n\t*/\n\tonEntityChange(evt) {\n\t\tif (evt.detail.name !== 'rotation') {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.el.sceneEl.object3D.updateMatrixWorld(true);\n\t\t// todo: support rotating entity\n\t},\n\n\tdisconnect() {\n\t\tif (this.audio) {\n\t\t\tthis.audio.disconnect();\n\t\t\tthis.audio.gain.disconnect();\n\t\t}\n\t\tif (this.renderer) {\n\t\t\tthis.renderer.input.disconnect();\n\t\t\tthis.renderer.output.disconnect();\n\t\t}\n\t}\n});\n\nAFRAME.registerPrimitive('a-ambisonic', {\n\tdefaultComponents: {\n\t\t'ambisonic': {}\n\t},\n\tmappings: {\n\t\tsrc: 'ambisonic.src',\n\t\tsources: 'ambisonic.sources',\n\t\tloop: 'ambisonic.loop',\n\t\tautoplay: 'ambisonic.autoplay',\n\t\torder: 'ambisonic.order',\n\t\t'use-media-element': 'ambisonic.useMediaElement',\n\t\t'channel-map': 'ambisonic.channelMap',\n\t\tmode: 'ambisonic.mode'\n\t}\n});\n"],"sourceRoot":""}